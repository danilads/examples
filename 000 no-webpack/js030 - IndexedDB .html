<!DOCTYPE html> 
<html>
<head>
	<meta charset="utf-8" />
	<title></title>
</head>
<body>
<div>
  <div>01 УДАЛИТЬ БАЗУ</div>
  <div><input type="input" id="id1" placeholder="название базы"/><button onclick="deleteBase()">удалить</button></div>
</div>
<br/>
<div>
  <div>02 СТАНДАРТНЫЙ КОНСТРУКТОР (создание / открытие)</div>
  <div><input type="input" id="id2" placeholder="название базы"/><button onclick="getNameAndVersion()">создание / открытие</button></div>
</div>
<br/>
<div>
  <div>03 ТРАНЗАКЦИЯ a) создать хранилище</div>
  <div><input type="input" id="id3a" placeholder="название базы"/><input type="input" id="id3b" placeholder="название хранилища"/><button onclick="createObjectStore()">открыть</button></div>
</div>

<script>
//----
////---- 01 <БАЗОВЫЕ ОПЕРАЦИИ>
//----

  // a) открыть базу (версия должна быть целым числом)
  let openBase = window.indexedDB.open("db", 3);
  console.log('---01a',openBase);

  // b) удалить базу
  let baseDelete = window.indexedDB.deleteDatabase('db1');
  console.log('---01b',baseDelete);

  // c) функция сравнения вернет версий (-1 первый меньше) (0 равный) (1 второй больше)
  console.log('---01c',window.indexedDB.cmp(1,2));

  // d) получить версии
  const DBpromise = window.indexedDB.databases()
  DBpromise.then(databases => {
    console.log('---01d',databases)
  })

  // e) удалить базу
  function deleteBase(){
    // получаем имя базы
    let baseName = document.getElementById('id1').value;

    var DBDeleteRequest = window.indexedDB.deleteDatabase(baseName);

    DBDeleteRequest.onerror = function(event) {
      console.log("---01e Error deleting database",event);
    };
    DBDeleteRequest.onsuccess = function(event) {
      console.log("---01e Database deleted successfully",event);
    };
    DBDeleteRequest.onblocked = function(event) {
      console.log("---01e Couldn't delete database due to the operation being blocked",event);
    };
  }

//----
////---- 02 <СТАНДАРТНЫЙ КОНСТРУКТОР>
//----

  // создать или открыть базу

  // a) получаем имя базы и версию (promise)
  function getNameAndVersion(){
    // получаем имя базы
    let baseName = document.getElementById('id2').value;

    // получем версию базы
    const DBpromise = window.indexedDB.databases()
    DBpromise.then(databases => {
      // если база есть - получим версию
      for(let i=0;databases.length>i;i++){
        if(baseName===databases[i].name){
          openBaseFunc(baseName,databases[i].version);
        }
      }
      // если база не создана - ставим версию - 1
      openBaseFunc(baseName,1);

    })
  }

  // b) конструктор
  function openBaseFunc(name, version){
    console.log('---02b name', name);
    console.log('---02b version', version);

    let openRequest = indexedDB.open(name, version);

    openRequest.onupgradeneeded = function() {
      // срабатывает, если на клиенте нет базы данных
      // ...выполнить инициализацию...
      console.log("---2b onupgradeneeded", openRequest);
    };

    openRequest.onerror = function() {
      console.log("---2b onerror", openRequest.error);
    };

    openRequest.onsuccess = function() {
      let db = openRequest.result;
      // продолжить работу с базой данных, используя объект db
      console.log("---2b onsuccess", db);
    };
  }

//----
////---- 03 <ТРАНЗАКЦИЯ>
//----

  // a) создать хранилище
  function createObjectStore(){
     // получаем имя базы
     let baseName = document.getElementById('id3a').value;
     let objectStoreName = document.getElementById('id3b').value;
     console.log('---3a',baseName);
     console.log('---3a',objectStoreName);
  }





</script>	
<body>
	
</body>
</html>