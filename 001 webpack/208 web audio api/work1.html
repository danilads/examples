<!DOCTYPE html> 
<html>
<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title></title>

</head>
<body>

	<button onclick="playSound()">Start</button>
	<button onclick="stopSound()">Stop</button>
	
  {/** var trackA -  трэк в формате base 64   **/}
	<script src="tr.js"></script>
	<script>
		var context = new AudioContext();
		var source = null;
		var audioBuffer = null;
	   
        //util
		function base64ToBuffer(buffer){
			var binary = window.atob(buffer);
			var buffer = new ArrayBuffer(binary.length);
			var bytes = new Uint8Array(buffer);
			for (var i = 0; i < buffer.byteLength; i++) {
				bytes[i] = binary.charCodeAt(i) & 0xFF;
			}
			return buffer;
		};
        
        var audioFromString = base64ToBuffer(trackA);
        
        context.decodeAudioData(audioFromString, (buffer)=> {
            audioBuffer = buffer;
            //здесь можно включать кнопки start/stop (disable off)
        });
        
		function stopSound() {
			if (source) {
				source.stop(0);
			}
		}
             
		function playSound() {
			source = context.createBufferSource();
			source.buffer = audioBuffer;
	
            var filters = createFilters();
            console.log('---wtf in filters',filters);
            source.connect(filters[0]);
            // а последний фильтр - к выходу
            filters[filters.length - 1].connect(context.destination);
            //source.connect(context.destination);
         
			source.start(0); // Play immediately.
		}
        
        //COMPRESSOR
        //https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode
        //https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext/createDynamicsCompressor
        
        //FILTERS
        // https://developer.mozilla.org/en-US/docs/Web/API/BiquadFilterNode
        var createFilter = (frequency) => {
          var filter = context.createBiquadFilter();
            
          filter.type = 'peaking'; // тип фильтра lowpass/highpass/bandpass/lowshelf/highshelf/peaking/notch/allpass
          filter.frequency.value = frequency; // частота
          filter.Q.value = 5; // Q-factor 0.0001 to 1000.
          filter.gain.value = -25; //-40 and 40

          return filter;
        };

        var createFilters = () => {
          var frequencies = [60, 170, 310, 600, 1000, 3000, 6000, 12000, 14000, 16000],
            filters = frequencies.map(createFilter);

          filters.reduce((prev, curr)=>{
            prev.connect(curr);
            return curr;
          });
          return filters;
        };
        
	
	
	</script>
</body> 
</html>