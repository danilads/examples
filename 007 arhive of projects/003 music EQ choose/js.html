<!DOCTYPE html> 
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title></title>
    <style>
        html{
            height: 100vh;
            width: 100vw;
        }
        body{
            position: absolute;
            outline: 1px solid gray;
            height: 100vh;
            width: 100vw;
            margin: 0;
        }
        button{
            width: 80px;
            padding: 5px;
            margin: 5px;
            height: 46px;
            white-space: nowrap; /* Запрещаем перенос строк */
			overflow: hidden; /* Обрезаем все, что не помещается в область */
			text-overflow: ellipsis;
        }
        .turnOn{
            color:red;
        }
        h2{
            margin: 0;
        }
        #container{
            height: 100%
        }
    </style>
	<!-- <script src="000-react.production.min.js"></script>
    <script src="000-react-dom.production.min.js"></script>
    <script src="000-babel.min.js"></script> -->
    <script crossorigin src="https://unpkg.com/react@16.8.6/umd/react.production.min.js"></script>
	<script crossorigin src="https://unpkg.com/react-dom@16.8.6/umd/react-dom.production.min.js"></script>
	<script crossorigin src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.5.4/babel.min.js"></script>

</head>
<body>
	<div id="container"></div> 
	<script type="text/babel">
    /////README
    //для изменнения нужно изменить две переменные
    // сколько должны быть вариантов ответов
    var howMuchFalseAnswers = 4;
    // имя файлов  -  они должны быть в wav формате
    // default файл должен иметь имя def.mp3 и массиве его не должно быть  

//	 var whyDoesMyHeartJson=[
//	 	 "boost90",
//         "boost9000",
//         "cut9000",
//         "cut90",
//         "down130",
//         "down220",
//         "down400",
//         "down700",
//         "down1100",
//         "down1500",
//         "down2200",
//         "down3000",
//         "down4000",
//         "down5000",
//         "down7000",
//         "down9000",
//         "up100",
//         "up200",
//         "up400",
//         "up700",
//         "up1100",
//         "up1500",
//         "up2200",
//         "up3000",
//         "up4000",
//         "up5000",
//         "up7000",
//         "up9000"
//	 ];
    var metlaDyeJson=[
		"cut100",
		"cut10000",
		"down50-200",
		"down200-1000",
		"down1000-2000",
		"down5000-20000",
		"up50-200",
		"up200-1000",
		"up1000-2000",
		"up5000-20000"
	]; 
	
	class TheGame extends React.PureComponent {
		state={
			cycle: 'start',     // цикл
            arrayOfAnswers: [], // массив ответов(с правильным)
			correct: '',        // правильное название
            pos:0,              // 0/1 переключалка между оригинлаьным и эквализированным
            button: 'def'       // 'def'/'rand' - состояние кнопки
 		}
        
		run=()=>{
            //получаем рандомный
            //запускаем с рандомным id
            let r = this.props.json[this.rand(0,this.props.json.length-1)]
            this.setState({cycle:'playing', correct:r, button:'rand'});
            
            
            //формируем ответы
            let arr = [];
            //добавляем правильный ответ
            arr.push(r);
            //добавляем рандомные ответы
            for(let i=0;i<howMuchFalseAnswers-1;i++){
                let r = this.props.json[this.rand(0,this.props.json.length-1)];
                if(arr.includes(r)){
                    i--;
                }
                else{
                    arr.push(r);
                }  
            }
            arr.sort(function() {
                return .5 - Math.random();
            });
            this.setState({arrayOfAnswers:arr});
             
            
            
            //запускаем стандартный
            let mediaDef=document.getElementById('def');
            mediaDef.volume = 0;
            mediaDef.play();
            
            
            //запускаем рандомный
			let media=document.getElementById(r);
			media.volume=1;
			media.play();
			media.onended = () => {
				
			};
		}
        playAganin=()=>{
            console.log('play again');
            //запускаем стандартный
            let mediaDef=document.getElementById('def');
            //вместо остановки
            mediaDef.pause();
            mediaDef.currentTime = 0;
            
            mediaDef.volume = 0;
            mediaDef.play();
            
            
            //запускаем рандомный
			let media=document.getElementById(this.state.correct);
            //вместо остановки
            media.pause();
            media.currentTime = 0;
            
			media.volume=1;
			media.play();
        }
        formAnswers=()=>{
                let {arrayOfAnswers} = this.state;
				return <div>
						<h2>choose correct answer</h2>
						<div style={{display:'flex'}}>{arrayOfAnswers.map(it=>{
                                return <button onClick={()=>{this.isCorrect(it,true)}} key={it}>{it}</button>
                            })}</div>
					</div>
        }
		buildButtons=()=>{
			if(this.state.cycle==="start"){			        
				return <div>
						<h2>{`song: ${this.props.folder}`}</h2>
				        <button onClick={()=>this.run()}>start</button>
					</div>    
			}
			else if(this.state.cycle==="playing"){
                return <div>
                    <h2>plaiyng</h2>
                    <div style={{display:'flex'}}>
                        <button className={`${this.state.button==='def'?'turnOn':''}`} onClick={()=>{this.volume('def')}}>def vol 100%</button>
                        <button className={`${this.state.button==='rand'?'turnOn':''}`} onClick={()=>{this.volume('rand')}}>random vol 100%</button>
                        <button onClick={this.playAganin}>playAgain</button>
                    </div>
                    <div>{this.formAnswers()}</div>
                </div>
			}
		};
        isCorrect=(e,isExternal)=>{
            if(isExternal && e===this.state.correct){
                this.setState({cycle: 'start'});
                
                //останавливаем правильный
                let mediaDef=document.getElementById('def');
                //вместо остановки
                mediaDef.pause();
                mediaDef.currentTime = 0;
                //останавливаем рандомный
                let media=document.getElementById(this.state.correct);
                //вместо остановки
                media.pause();
                media.currentTime = 0;
          
                
                console.log('correct');
            }
            else if(e===this.state.correct){
                this.run();
            }
            
        }
        volume=(e)=>{
            let mediaDef=document.getElementById('def');
            let media=document.getElementById(this.state.correct);
            if(e==='def'){
                mediaDef.volume = 1;
                media.volume=0;
                this.setState({button:'def'});
            }
            else if(e==='rand'){
                mediaDef.volume = 0;
                media.volume=1;
                this.setState({button:'rand'});
            }
        };
    
		rand = (min, max) => {
		    return Math.round(min - 0.5 + Math.random() * (max - min + 1));
		  }
		render() {
            console.log('---rerender',this.props);
			return (
				<div>
					{this.buildButtons()}
                    {this.props.folder.length>0
                            &&
                        <audio id="def">
                          <source src={`${this.props.folder}/def.mp3`}/>
                        </audio> 
                    }
					
					{this.props.json.map(it=>{
						return <audio id={it}>
								  <source src={`${this.props.folder}/${it}.mp3`}/>
								</audio> 
					})}
					
				</div>
			);
		}
	}
    //this.setState({folderName:"metlaDye",jsonAnswers:metlaDyeJson}
    class InitialComp extends React.Component {
		state = {
            folder:'',
            json: [],
		}


		render() {
            
            let name = "metlaDyeJson";
            let json = metlaDyeJson;
        
            
			return (
                <div style={{position:'relative', height:'100%'}}>
                    <button style={{position:'absolute',bottom: '0px',right:'0px'}} onClick={()=>this.setState({folder:'',json:[]})}>exit</button>
                    {this.state.folder === '' && <h2>Game - Choose correct EQ</h2>}
                    {this.state.folder === '' &&<button onClick={()=>{this.setState({folder:name,json:json})}}>{name}</button>}
                    {this.state.folder === name && <TheGame folder={this.state.folder} json={this.state.json}/>}
                        
              
                </div>
			);
		}
	}
    
	////////////////App Js
		ReactDOM.render(
			<InitialComp/>
			,document.getElementById('container')
		);
	</script>
</body> 
</html>